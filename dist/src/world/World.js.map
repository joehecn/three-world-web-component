{"version":3,"file":"World.js","sourceRoot":"","sources":["../../../src/world/World.ts"],"names":[],"mappings":"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","sourcesContent":["import { DirectionalLightHelper, CameraHelper } from 'three';\n\nimport * as THREE from 'three';\n\nimport GUI from 'lil-gui';\nimport {\n  createScene,\n  createLights,\n  // Node,\n  createCamera,\n  loadBuilding,\n} from './components/index.js';\n\nimport {\n  createRenderer,\n  createControls,\n  Resizer,\n  ColorGUIHelper,\n  MinMaxGUIHelper,\n} from './systems/index.js';\n\nfunction __setScissorForElement(\n  canvas: HTMLCanvasElement,\n  elem: HTMLDivElement\n) {\n  const canvasRect = canvas.getBoundingClientRect();\n  const elemRect = elem.getBoundingClientRect();\n\n  // 计算canvas的尺寸\n  const right = Math.min(elemRect.right, canvasRect.right) - canvasRect.left;\n  const left = Math.max(0, elemRect.left - canvasRect.left);\n  const bottom = Math.min(elemRect.bottom, canvasRect.bottom) - canvasRect.top;\n  const top = Math.max(0, elemRect.top - canvasRect.top);\n\n  const width = Math.min(canvasRect.width, right - left);\n  const height = Math.min(canvasRect.height, bottom - top);\n\n  // 设置剪函数以仅渲染一部分场景\n  const positiveYUpBottom = canvasRect.height - bottom;\n\n  // 返回aspect\n  return {\n    left,\n    positiveYUpBottom,\n    width,\n    height,\n  };\n}\n\nexport class World {\n  private _scene: THREE.Scene;\n\n  private _mainCamera: THREE.PerspectiveCamera;\n\n  private _secondCamera: THREE.PerspectiveCamera;\n\n  private _renderer: THREE.WebGLRenderer;\n\n  private _mainView: HTMLDivElement;\n\n  private _secondView: HTMLDivElement;\n\n  private _lightHelper: THREE.DirectionalLightHelper;\n\n  private _cameraHelper: THREE.CameraHelper;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    mainView: HTMLDivElement,\n    secondView: HTMLDivElement,\n    controlView: HTMLDivElement\n  ) {\n    this._mainView = mainView;\n    this._secondView = secondView;\n\n    this._renderer = createRenderer(canvas);\n    this._scene = createScene();\n\n    const { mainLight, secondLight } = createLights();\n\n    let aspect = 2;\n\n    {\n      const { left, positiveYUpBottom, width, height } = __setScissorForElement(\n        this._renderer.domElement,\n        this._mainView\n      );\n\n      aspect = width / height;\n\n      this._mainCamera = createCamera(\n        [75, aspect, 1, 300] // option: [fov, aspect, near, far]\n      );\n\n      this._renderer.setScissor(left, positiveYUpBottom, width, height);\n      this._renderer.setViewport(left, positiveYUpBottom, width, height);\n    }\n\n    {\n      this._secondView.style.height = `${\n        this._secondView.clientWidth / aspect\n      }px`;\n\n      const { left, positiveYUpBottom, width, height } = __setScissorForElement(\n        this._renderer.domElement,\n        this._secondView\n      );\n\n      this._secondCamera = createCamera(\n        [120, aspect, 1, 300], // option: [fov, aspect, near, far]\n        [-90, 300, 30] // position: [x, y, z]\n      );\n\n      this._renderer.setScissor(left, positiveYUpBottom, width, height);\n      this._renderer.setViewport(left, positiveYUpBottom, width, height);\n    }\n\n    const gui = new GUI({\n      container: controlView,\n      width: 400,\n      // title: 'Config',\n      injectStyles: false,\n    });\n\n    const lightsFolder = gui.addFolder('Lights');\n    const mainLightFolder = lightsFolder.addFolder('Main Light');\n    // Option\n    const mainLightOptionFolder = mainLightFolder.addFolder('Option');\n    mainLightOptionFolder\n      .addColor(new ColorGUIHelper(mainLight, 'color'), 'value')\n      .name('Color')\n      .onChange(this.render.bind(this));\n    mainLightOptionFolder\n      .add(mainLight, 'intensity', 0, 2, 0.01)\n      .onChange(this.render.bind(this));\n    // Position\n    const mainLightPositionFolder = mainLightFolder.addFolder('Position');\n    mainLightPositionFolder\n      .add(mainLight.position, 'x', -400, 400, 1)\n      .onChange(this.render.bind(this));\n    mainLightPositionFolder\n      .add(mainLight.position, 'y', -400, 400, 1)\n      .onChange(this.render.bind(this));\n    mainLightPositionFolder\n      .add(mainLight.position, 'z', -400, 400, 1)\n      .onChange(this.render.bind(this));\n\n    const secondLightFolder = lightsFolder.addFolder('Second Light');\n    secondLightFolder\n      .addColor(new ColorGUIHelper(secondLight, 'color'), 'value')\n      .name('Sky Color')\n      .onChange(this.render.bind(this));\n    secondLightFolder\n      .addColor(new ColorGUIHelper(secondLight, 'groundColor'), 'value')\n      .name('Ground Color')\n      .onChange(this.render.bind(this));\n    secondLightFolder\n      .add(secondLight, 'intensity', 0, 2, 0.01)\n      .onChange(this.render.bind(this));\n\n    const minMaxGUIHelper = new MinMaxGUIHelper(\n      this._mainCamera,\n      'near',\n      'far',\n      0.1\n    );\n\n    const cameraFolder = gui.addFolder('Camera');\n    // Option\n    const cameraOptionFolder = cameraFolder.addFolder('Option');\n    cameraOptionFolder\n      .add(this._mainCamera, 'fov', 1, 180)\n      .onChange(this.render.bind(this));\n    cameraOptionFolder\n      .add(minMaxGUIHelper, 'min', 0.1, 10, 0.1)\n      .name('near')\n      .onChange(this.render.bind(this));\n    cameraOptionFolder\n      .add(minMaxGUIHelper, 'max', 0.1, 600, 0.1)\n      .name('far')\n      .onChange(this.render.bind(this));\n    // Position\n    const cameraPositionFolder = cameraFolder.addFolder('Position');\n    cameraPositionFolder\n      .add(this._mainCamera.position, 'x', -300, 300, 0.1)\n      .onChange(this.render.bind(this));\n    cameraPositionFolder\n      .add(this._mainCamera.position, 'y', -300, 300, 0.1)\n      .onChange(this.render.bind(this));\n    cameraPositionFolder\n      .add(this._mainCamera.position, 'z', -300, 300, 0.1)\n      .onChange(this.render.bind(this));\n\n    const mainControls = createControls(this._mainCamera, mainView);\n    mainControls.addEventListener('change', this.render.bind(this));\n\n    const secondControls = createControls(this._secondCamera, secondView);\n    secondControls.addEventListener('change', this.render.bind(this));\n\n    // const _node = new Node();\n    // _node.addEventListener('load-ok', () => {\n    //   console.log('---- load-ok');\n    //   this.render();\n    // });\n\n    const resizer = new Resizer(this._renderer);\n    resizer.addEventListener('window-resize', this.render.bind(this));\n\n    this._lightHelper = new DirectionalLightHelper(mainLight);\n    this._cameraHelper = new CameraHelper(this._mainCamera);\n\n    this._scene.add(\n      mainLight,\n      secondLight,\n      this._lightHelper,\n      this._cameraHelper\n    );\n  }\n\n  public async init() {\n    const building = await loadBuilding();\n    this._scene.add(building);\n    this.render();\n  }\n\n  public render() {\n    this._renderer.setScissorTest(true);\n\n    let aspect = 2;\n\n    {\n      const { left, positiveYUpBottom, width, height } = __setScissorForElement(\n        this._renderer.domElement,\n        this._mainView\n      );\n\n      aspect = width / height;\n\n      this._renderer.setScissor(left, positiveYUpBottom, width, height);\n      this._renderer.setViewport(left, positiveYUpBottom, width, height);\n\n      this._mainCamera.aspect = aspect;\n      this._mainCamera.updateProjectionMatrix();\n\n      this._lightHelper.visible = false;\n      this._cameraHelper.visible = false;\n\n      this._renderer.render(this._scene, this._mainCamera);\n    }\n\n    {\n      this._secondView.style.height = `${\n        this._secondView.clientWidth / aspect\n      }px`;\n\n      const { left, positiveYUpBottom, width, height } = __setScissorForElement(\n        this._renderer.domElement,\n        this._secondView\n      );\n\n      this._renderer.setScissor(left, positiveYUpBottom, width, height);\n      this._renderer.setViewport(left, positiveYUpBottom, width, height);\n\n      this._secondCamera.aspect = aspect;\n      this._secondCamera.updateProjectionMatrix();\n\n      this._lightHelper.visible = true;\n      this._cameraHelper.visible = true;\n\n      // this._scene!.background.set(0x000040);\n\n      this._renderer.render(this._scene, this._secondCamera);\n    }\n\n    this._lightHelper.update();\n    this._cameraHelper.update();\n  }\n\n  // start() {\n  //   this._loop.start();\n  // }\n\n  // stop() {\n  //   this._loop.stop();\n  // }\n}\n"]}